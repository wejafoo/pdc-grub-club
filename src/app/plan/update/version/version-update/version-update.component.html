

<div id="page-title"><h3> Plan ID: <strong> {{planId}} </strong> Version: <strong> {{versionId}} </strong></h3><a style="visibility: hidden; " (click)="loadVersion( loadedVer['id'])"><mat-icon> add </mat-icon></a></div>
<div id="page-body">
	<nav id="page-title-2">
		<div><h3> Schedule </h3></div>
		<div *ngIf="deepEqual( loadedVer, ver ); else changes_made">
			<a style="background-color: floralwhite; color: gainsboro; "> Save </a>
			<a (click)="toVersions()"> Back </a>
		</div>
			<ng-template #changes_made>
				<div>
					<a style="background-color: #425; color: white; " (click)="save()"	> Save </a>
					<a (click)="toVersions()"> Cancel </a>
				</div>
			</ng-template>
	</nav><hr/><div>
		<mat-accordion>
<!--
					###########
			#### SUMMARY ########################################################################################################
-->
			<mat-expansion-panel>
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Summary Information </strong>
					</mat-panel-title>
					<mat-panel-description>
						General stats reflective of this version <mat-icon> info </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<div *ngIf="deepEqual( loadedVer, ver ); else changes_made_2"> Loaded version: <strong> {{ver['id']}} </strong></div>
					<ng-template #changes_made_2><div><h3><span class="mat-warn"> Unsaved new version: </span><strong> {{ver['id'] + 1}} </strong></h3></div></ng-template>
				<div>	Total active hosts: <strong> 20	</strong></div>
				<div>	Total active guests: <strong> 20 </strong></div>
				<div> <br/> Host seats available by event <br/> <hr/>
					<div style="display: flex; justify-content: space-evenly; ">
						<div> January: <strong> 110 </strong></div><div> February: <strong> 80 </strong></div><div> March: <strong> 135 </strong></div>
					</div>
				</div>
			</mat-expansion-panel>
<!--
					####################
			#### VERSION METADATA ###########################################################################################
-->
			<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
				<mat-expansion-panel-header><mat-panel-title><strong> Version Metadata </strong></mat-panel-title><mat-panel-description> Misc info to help identify this version <mat-icon> more </mat-icon></mat-panel-description></mat-expansion-panel-header>
				<div><h4><label for="next-labels"> Labels: </label><input type="text" id="next-labels" [(ngModel)]="ver['labels']" placeholder="labels(comma-separated)" /></h4>
				</div>
			</mat-expansion-panel>
<!--
					#############################
			#### EVENT DATE CONFIGURATIONS ###################################################################################
			<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
				<mat-expansion-panel-header><mat-panel-title><strong> Event Dates </strong></mat-panel-title><mat-panel-description> Provide the specific dates for each event <mat-icon> date_range </mat-icon></mat-panel-description></mat-expansion-panel-header>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: January	</mat-label><input matInput [matDatepicker]="picker1" (focus)="picker1.open()"></mat-form-field><mat-datepicker #picker1></mat-datepicker></div>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: February	</mat-label><input matInput [matDatepicker]="picker2" (focus)="picker2.open()"></mat-form-field><mat-datepicker #picker2></mat-datepicker></div>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: March	</mat-label><input matInput [matDatepicker]="picker3" (focus)="picker3.open()"></mat-form-field><mat-datepicker #picker3></mat-datepicker></div>
			</mat-expansion-panel>
			
				#######################
		#### HOST CONFIGURATIONS ############################################################################################
-->
			<mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Host Configuration </strong>
					</mat-panel-title>
					<mat-panel-description>
						Schedule hosts for this event <mat-icon> person </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<hr/>
				<div class="events" *ngFor="let e of ver['events']">
					<div class="event-heading">
						<div>
							<h4><strong> {{e.name}} </strong> Hosts </h4>
						</div>
						<div>
							Auto-assign:
							<button (click)="autoAllocateHosts('all'	)">	 	All 				</button>
							<button (click)="autoAllocateHosts( e.name			)"> 	{{e.name}}	</button>
						</div>
					</div>
					<table cdkDropListGroup>
						<tr>
							<th>	Unallocated		</th>
							<th>	Allocated			</th>
						</tr>
						<tr>
							<!-- UN-ASSIGNED HOSTS -->
							<td cdkDropList id="unallocated" class="unassigned list" [cdkDropListData]="unHs[e.name]" (cdkDropListDropped)="unDropHost( $event, e.name )">
								<div *ngFor="let unH of unHs[e.name]">
									<mat-card cdkDrag [cdkDragData]="unH" [cdkDragDisabled]="unH['isDisabled']">
										<mat-icon> menu </mat-icon> {{ unH['hostKey'] }}
									</mat-card>
								</div>
							</td>
							<td class="vertical-info">
								<!-- EVENT HOSTING SUMMARY -->
								<div>		Seat Status																												</div><hr/>
								<div>		UNALLOCATED																												</div>
								<div>		<strong>{{ this.summary[e.name]['unallocatedSeats'] }}</strong>		</div>
								<div>		ALLOCATED																													</div>
								<div [class]="summary[e.name]['overAllocatedSeats'] >= 0 ? 'full' : 'not-full'">
												<strong>{{ summary[e.name]['allocatedSeats'] }}</strong> &nbsp; &nbsp; &nbsp;
												(&nbsp;{{ summary[e.name]['overAllocatedSeats'] }} &nbsp; )
								</div>
								<div>		TOTAL GUESTS 																											</div>
								<div [class]="summary[e.name]['allocatedSeats'] >= summary[e.name]['totalGuests'] ? 'full' : 'not-full'">
												<strong>{{ summary[e.name]['totalGuests'] }}</strong>
								</div>
							</td>
							<!-- ASSIGNED HOSTS -->
							<td cdkDropList id="allocated" [cdkDropListData]="aHs[e.name]" (cdkDropListDropped)="dropHost($event, e.name)"
									[class]="summary[e.name]['overAllocatedSeats'] >= 0 ? 'assigned list full' : 'assigned list not-full'"
							>
								<div *ngFor="let aH of aHs[e.name]">
									<mat-card cdkDrag [cdkDragData]="aH" id="{{ aH['hostKey'] }}">
										<mat-icon> menu </mat-icon>{{ aH['hostKey'] }}
									</mat-card>
								</div>
							</td>
						</tr>
					</table>
				</div>
				<mat-action-row><button mat-button (click)="prevStep()"> Previous </button><button mat-button (click)="nextStep()"> Next </button></mat-action-row>
			</mat-expansion-panel>
<!--
					########################
			####  GUEST CONFIGURATION  #######################################################################################
-->
			<mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Guest Configuration </strong>
					</mat-panel-title>
					<mat-panel-description>
						Schedule guests for this event <mat-icon> people </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<hr/>
				<div  class="events" *ngFor="let e of ver['events']">
					<div class="event-heading">
						<div>
							<h4><strong> {{e.name}} </strong></h4>
						</div>
						<div>
							Auto-assign:		<button (click)="autoAssignGuests('all'		)"> 	All 				</button>
															<button (click)="autoAssignGuests( e.name				)"> 	{{e.name}}	</button>
						</div>
					</div>
					<table cdkDropListGroup>
						<tr>
							<th style="width: 45%; "> 	Unassigned Guests		</th>
							<th style="width: 20%; ">		<button (click)="isOpen=!isOpen">{{ isOpen ? "Peeps View" : "Card View" }}</button></th>
							<th style="width: 45%; "> 	Assigned Guests			</th></tr>
						<tr>
							<!-- UN-ASSIGNED GUESTS -->
							<td cdkDropList class="unassigned list" id="unassigned" [cdkDropListData]="unGs[e.name]" (cdkDropListDropped)="unDropGuest($event, e.name)">
								<div *ngFor="let unG of unGs[e.name]">
									<mat-card cdkDrag id="{{ unG['guestKey'] }}" [cdkDragData]="unG" [cdkDragDisabled]="unG['isDisabled']">
										<mat-icon> menu </mat-icon>
										{{ unG['guestKey'] }}
									</mat-card>
								</div>
							</td>
							<!-- EVENT GUEST SUMMARY -->
							<td class="vertical-info">
								<div>		<strong> Guest Status </strong>																</div><hr/>
								<div>		UNASSIGNED																										</div>
								<div>		<strong>{{ summary[e.name]['unassignedGuests'] }}</strong>		</div>
								<div>		ASSIGNED																											</div>
								<div [class]="summary[e.name]['assignedGuests'] >= summary[e.name]['allocatedSeats'] ?'not-full': 'full'">
												<strong>{{ summary[e.name]['assignedGuests'] }}</strong>
								</div><hr/>
								<div>		<strong> Seat Status </strong>																</div><hr/>
								<div>		ALLOCATED																											</div>
								<div>		<strong>{{ summary[e.name]['allocatedSeats'] }}</strong>			</div>
								<div>		OVER / UNDER																									</div>
								<div>		<strong>{{ summary[e.name]['overAllocatedSeats'] }}</strong>	</div><hr/>
								<div>		ASSIGNED																											</div>
								<div [class]="summary[e.name]['assignedSeats'] >= summary[e.name]['allocatedSeats'] ?'not-full': 'full'">
												<strong>{{ summary[e.name]['assignedSeats'] }}</strong>
								</div>
								<div>		OVER / UNDER																									</div>
								<div>		<strong>{{ summary[e.name]['unassignedSeats'] }}</strong>			</div><hr/>
							</td>
							<!-- ASSIGNED GUESTS -->
							<td>
								<div cdkDropList *ngFor="let aH of aHs[e.name]" [id]="aH['hostKey']" style="border-style: inset; padding: .25em;"
										[cdkDropListData]="aGs[e.name][aH['hostKey']]" (cdkDropListDropped)="dropGuest($event, e.name)" [cdkDropListEnterPredicate]="pairsPredicate()"
								>
									{{ aH['hostKey'] }}
									<!-- Event assigned guests - peeps view -->
									<div	*ngIf="!isOpen; else boxView" [class]="summary[e.name][ aH['hostKey'] ]['assignedSeats'] >= aH['seats'] ?	'polyBase poly-' + aH['seats'] + ' full-host' : 'polyBase poly-' + aH['seats'] + ' not-full-host'">
										<div [class]="'poly-content-' + aH['seats']">
											<div *ngFor	= "let cnt of [].constructor( aH['seats']); let i = index">
												<mat-icon class="assigned-guest-host" *ngIf="i <= ( summary[e.name][aH['hostKey']]['hosts']-1 ); else notHost"> person </mat-icon>
												<ng-template #notHost>
													<mat-icon class="assigned-guest-guest" *ngIf="i <= ( summary[e.name][ aH['hostKey']]['assignedSeats'] - 1 ); else notAssigned"> person </mat-icon>
													<ng-template #notAssigned><mat-icon class="unassigned-guest"> person_outline </mat-icon></ng-template>
												</ng-template>
											</div>
										</div>
									</div>
									<!-- Event assigned guests - card view -->
									<ng-template #boxView>
										<div [class]="summary[e.name][ aH['hostKey']]['assignedSeats'] >= aH['seats'] ? 'polyBase list full-host' : 'polyBase list not-full-host'">
											<div *ngFor="let aG of aGs[e.name][aH['hostKey']]">
												<!-- div *ngFor="let aG of aH" -->
												<mat-card cdkDrag id="{{ aG['guestKey'] }}" [cdkDragData]="aG" [cdkDragDisabled]="aG['isDisabled']" >
													<mat-icon> menu </mat-icon>
													{{ aG['guestKey'] }}
												</mat-card>
											</div>
										</div>
									</ng-template>
								</div>
							</td>
						</tr>
					</table>
				</div>
				<mat-action-row>
					<button mat-button (click)="prevStep()"> 	Previous 	</button>
					<button mat-button (click)="nextStep()"> 	End 			</button>
				</mat-action-row>
			</mat-expansion-panel>
		</mat-accordion>
	</div>
</div>
