

<div id="page-title">
	<h3>
		Plan ID:	<strong> {{planId}}			</strong>
		Name:		<!-- strong> {{plan["name"]}}</strong -->
		Version:	<strong> {{versionId}}		</strong>
	</h3>
	<a style="visibility: hidden; " (click)="loadVersion( loadedVer['id'])"><mat-icon> add </mat-icon></a>
</div>
<div id="page-body">
	<nav id="page-title-2">
		<div><h3> Schedule </h3></div>
		<div *ngIf="deepEqual( loadedVer, ver ); else changes_made">
			<a style="background-color: floralwhite; color: gainsboro; "> Save </a>
			<a (click)="toVersions()"									> Back </a>
		</div>
			<ng-template #changes_made>
				<div>
					<a style="background-color: #425; color: white; " (click)="save()"	> Save </a>
					<a (click)="toVersions()"											> Cancel </a>
				</div>
			</ng-template>
	</nav>
	<hr/>
	<div>
		<mat-accordion>

		
<!--
############################################################################################################
#### SUMMARY
############################################################################################################
-->
			<mat-expansion-panel>
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Summary Information </strong>
					</mat-panel-title>
					<mat-panel-description>
						General stats reflective of this version <mat-icon> info </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<div *ngIf="deepEqual( loadedVer, ver ); else changes_made_2">
					Loaded version: <strong> {{ver["id"]}} </strong>
				</div>
					<ng-template #changes_made_2>
						<div>
							<h3>
								<span class="mat-warn"> Unsaved new version: </span><strong> {{ver['id'] + 1}} </strong>
							</h3>
						</div>
					</ng-template>
				<div>	Total active hosts: <strong> 20	</strong></div>
				<div>	Total active guests: <strong> 20 </strong></div>
				<div> <br/> Host seats available by event <br/> <hr/>
					<div style="display: flex; justify-content: space-evenly; ">
						<div> January:	<strong> 110	</strong></div>
						<div> February:	<strong> 80		</strong></div>
						<div> March:	<strong> 135	</strong></div>
					</div>
				</div>
			</mat-expansion-panel>
			
			
<!--
############################################################################################################
#### VERSION METADATA
############################################################################################################
-->
			<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
				<mat-expansion-panel-header>
					<mat-panel-title>			<strong> Version Metadata </strong>										</mat-panel-title>
					<mat-panel-description>		Misc info to help identify this version <mat-icon> more </mat-icon>		</mat-panel-description>
				</mat-expansion-panel-header>
				<div>
					<h4>
						<label for="next-labels"> Labels: </label>
						<input type="text" id="next-labels" [(ngModel)]="ver['labels']" placeholder="labels(comma-separated)" />
					</h4>
				</div>
			</mat-expansion-panel>
			
			
<!--
############################################################################################################
#### EVENT DATE CONFIGURATIONS
############################################################################################################

			<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
				<mat-expansion-panel-header><mat-panel-title><strong> Event Dates </strong></mat-panel-title><mat-panel-description> Provide the specific dates for each event <mat-icon> date_range </mat-icon></mat-panel-description></mat-expansion-panel-header>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: January	</mat-label><input matInput [matDatepicker]="picker1" (focus)="picker1.open()"></mat-form-field><mat-datepicker #picker1></mat-datepicker></div>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: February	</mat-label><input matInput [matDatepicker]="picker2" (focus)="picker2.open()"></mat-form-field><mat-datepicker #picker2></mat-datepicker></div>
				<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: March	</mat-label><input matInput [matDatepicker]="picker3" (focus)="picker3.open()"></mat-form-field><mat-datepicker #picker3></mat-datepicker></div>
			</mat-expansion-panel>

			
############################################################################################################
#### HOST CONFIGURATIONS
############################################################################################################
-->
			<mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Host Configuration </strong>
					</mat-panel-title>
					<mat-panel-description>
						Schedule hosts for this event <mat-icon> person </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header><hr/>
				<div class="events" *ngFor="let pEvent of ver['events']">
					<div class="event-heading">
						<div><h4><strong> {{pEvent.name}} </strong> Hosts </h4></div>
						<div>
							Auto-assign:
							<button (click)="autoAssignHosts('all')"	>	All 			</button>
							<button (click)="autoAssignHosts(pEvent.name)"	>	{{pEvent.name}}	</button>
						</div>
					</div>
					<table cdkDropListGroup>
						<tr><th> Unallocated </th><th> Allocated </th></tr>
						<tr>
							<td cdkDropList class="unassigned list" [cdkDropListData]="unassignedHosts[pEvent.name]" (cdkDropListDropped)="unassignHost($event)"><!-- (cdkDropListDropped) = "unassignHost( $event, pEvent.name )" -->
								<div class="example-list" *ngFor="let unassignedHost of unassignedHosts[pEvent.name]">
									<mat-card cdkDrag [cdkDragDisabled]="unassignedHost.disabled" *ngIf="!unassignedHost['assigned']">
										<mat-icon> menu </mat-icon><strong> {{unassignedHost['hostName']}}-{{unassignedHost['seats']}} </strong>
									</mat-card>
								</div>
							</td>
							<td class="vertical-info">
								<div>	Seat Status </div><hr/>
								<div>	UNALLOCATED </div>
								<div>	<strong> {{ unSeatCnt[pEvent.name] }} </strong>	</div>
								<div>	ALLOCATED </div>
								<div [class]=" aSeatCnt[pEvent.name] >= ( unGuestCnt[pEvent.name] + aGuestCnt[pEvent.name].all) ? 'full' : 'not-full'">
									<strong> {{ aSeatCnt[pEvent.name] }} </strong> &nbsp; &nbsp; &nbsp; ( {{ aSeatCnt[pEvent.name] - (unGuestCnt[pEvent.name] + aGuestCnt[pEvent.name].all)	}} )
								</div>
								<div>	TOTAL GUESTS </div>
								<div [class]=" aSeatCnt[pEvent.name] >= ( unGuestCnt[pEvent.name]	+ aGuestCnt[pEvent.name].all) ? 'full' : 'not-full'">
									<strong> {{ unGuestCnt[pEvent.name] + aGuestCnt[pEvent.name].all }} </strong>
								</div>
							</td>
							<td cdkDropList class="assigned list" [cdkDropListData]="assignedHosts[pEvent.name]" (cdkDropListDropped) = "assignHost( $event, pEvent.name )"><!-- (cdkDropListDropped) = "assignHost( $event, pEvent.name )" -->
								<div *ngFor="let aHost of assignedHosts[pEvent.name]"><mat-card cdkDrag><mat-icon> menu </mat-icon><strong>{{aHost['hostName']}}-{{aHost['seats']}}</strong></mat-card></div>
							</td>
						</tr>
					</table>
				</div>
				<mat-action-row>
					<button mat-button (click)="prevStep()"> Previous </button><button mat-button (click)="nextStep()"> Next </button>
				</mat-action-row>
			</mat-expansion-panel>
			
			
<!--
############################################################################################################
#### GUEST CONFIGURATION
############################################################################################################
-->
			<mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
				<mat-expansion-panel-header>
					<mat-panel-title>
						<strong> Guest Configuration </strong>
					</mat-panel-title>
					<mat-panel-description>
						Schedule guests for this event <mat-icon> people </mat-icon>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<hr/>
				<div  class="events" *ngFor="let pEvent of ver['events']">
					<div class="event-heading">
						<div><h4><strong> {{pEvent.name}} </strong></h4></div>
						<div>
							Auto-assign:
							<button (click)="autoAssignGuests('all' )"	> All				</button>
							<button (click)="autoAssignGuests( pEvent.name )"	> {{pEvent.name}}	</button>
						</div>
					</div>
					<table cdkDropListGroup>
						<tr><th> Unassigned Guests </th><th> Assigned Guests </th></tr>
						<tr>
							<td cdkDropList class="unassigned list" [cdkDropListData]="unassignedGuests[pEvent.name]" (cdkDropListDropped)="unassignGuest($event)">
								<div *ngFor="let unGuest of unassignedGuests[pEvent.name]">
									<mat-card cdkDrag [cdkDragDisabled]="unGuest.disabled"><mat-icon> menu </mat-icon> <strong> {{ unGuest["partyName"] }} </strong></mat-card>
								</div>
							</td>
							<td class="vertical-info">
								<div>	Guest Status	</div><hr/>
								<div>	UNASSIGNED		</div><div><strong> {{unGuestCnt[pEvent.name]}} </strong></div>
								<div>	ASSIGNED		</div>
								
								<div [class]="aGuestCnt[pEvent.name].all >= aSeatCnt[pEvent.name] ?'not-full': 'full'">
										<strong> {{ aGuestCnt[pEvent.name].all }} </strong>
								</div><hr/>
								
								<div>	Seat Status		</div><hr/>
								<div>	UNALLOCATED		</div><div><strong> {{unSeatCnt[pEvent.name]}} </strong></div>
								<div>	ALLOCATED		</div><div><strong> {{aSeatCnt[pEvent.name]}} </strong>	</div><hr/>
							</td>
							<td>
								<div *ngFor="let aHost of assignedHosts[pEvent.name]">
									{{aHost['hostName']}}-{{aHost['seats']}}
									<div cdkDropList class="polyBase" [class]="'poly-'+aHost['seats']" [cdkDropListData]="assignedGuests[pEvent.name][aHost['hostName']]" (cdkDropListDropped)="assignGuest($event)"><!-- (cdkDropListDropped) = "assignGuest( $event, pEvent.name )" -->
										<div [class]="'poly-content-' + aHost['seats']">
											<div *ngFor	= "let e of [].constructor( aHost['seats']); let i = index">
												<!-- {{aGuestCnt[pEvent.name][aHost]}} -->
												<mat-icon class="assigned-guest-host" *ngIf="i <= ( aGuestCnt[pEvent.name][aHost['hostName']]['hosts']-1 ); else notHost">
													person
												</mat-icon>
												<ng-template #notHost>
													<mat-icon class="assigned-guest-guest" *ngIf="i <= ( aGuestCnt[pEvent.name][aHost['hostName']].all-1 ); else notAssigned">
														person
													</mat-icon>
													<ng-template #notAssigned>
														<mat-icon class="unassigned-guest">
															person_outline
														</mat-icon>
													</ng-template>
												</ng-template>
											</div>
										</div>
									</div>
								</div>
							</td>
						</tr>
					</table>
				</div>
				<mat-action-row><button mat-button (click)="prevStep()"> Previous </button><button mat-button (click)="nextStep()"> End </button></mat-action-row>
			</mat-expansion-panel>
		</mat-accordion>
	</div>
</div>
