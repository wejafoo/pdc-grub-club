

<div id="page-title">
	<h3> Plan ID: <strong>{{planId}}</strong> Version: <strong>{{versionId}}</strong></h3>
	<a style="visibility: hidden; " [routerLink]="['/plan', planId, 'version', versionId + 1]">
		<mat-icon> add </mat-icon>
	</a>
</div>
<div id="page-body">
	<nav id="page-title-2">
		<div><h3> Schedule </h3></div>
		<div *ngIf="deepEqual(ver, ver); else changes_made"><a style="background-color: floralwhite; color: gainsboro; "> Save </a><a (click)="toVersions()"> Back </a></div>
		<ng-template #changes_made><div><a style="background-color: #425; color: white; " (click)="save()"> Save </a><a (click)="toVersions()"> Cancel </a></div></ng-template>
	</nav><hr/><div>
	<mat-accordion>
		<!-- ##############################################################################################  SUMMARY  ## -->
		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>
					<strong> Summary / Settings </strong>
				</mat-panel-title>
				<mat-panel-description>
					General version information and event settings  <mat-icon> info </mat-icon>
				</mat-panel-description>
			</mat-expansion-panel-header>
			
			
			<!-- #######################################################################################  Event SETTINGS  ##-->
			<div style="display: flex; justify-content: space-between; align-items: center">
				<div style="display: flex; background-color: aliceblue">
					Event Settings:
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="eventSetting1" name="vehicle1" value="true" checked>
					<label for="eventSetting1"> Auto-allocate most seats first </label>
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="eventSetting2" name="vehicle2" value="true">
					<label for="eventSetting2"> I want a new car </label>
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="eventSetting3" name="vehicle3" value="true">
					<label for="eventSetting3"> I want a new boat </label>
				</div>
			</div>
			<!-- #######################################################################################  Host SETTINGS  ##-->
			<div style="display: flex; justify-content: space-between; align-items: center">
				<div style="display: flex; background-color: aliceblue">
					Allocation Settings:
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="allocationSetting1" name="vehicle1" value="true" checked>
					<label for="allocationSetting1"> Auto-allocate most seats first </label>
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="allocationSetting2" name="vehicle2" value="true">
					<label for="allocationSetting2"> I want a new car </label>
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="allocationSetting3" name="vehicle3" value="true">
					<label for="allocationSetting3"> I want a new boat </label>
				</div>
			</div>
			<!-- ######################################################################################  guest SETTINGS  ##-->
			<div style="display: flex; justify-content: space-between; align-items: center">
				<div style="display: flex; background-color: aliceblue">
					Assignment Settings:
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="assignmentSetting1" name="vehicle1" value="true" checked>
					<label for="assignmentSetting1"> Allow host over-assignment </label>
				</div>
				<div style="display: flex; background-color: aliceblue">
					Force sort:
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="assignmentSetting2" name="vehicle2" value="true" checked>
					<label for="assignmentSetting2"> Unassigned Guests </label>
				</div>
				<div style="display: flex;">
					<input type="checkbox" id="assignmentSetting3" name="vehicle2" value="true">
					<label for="assignmentSetting3"> Assigned Guests </label>
				</div>
			</div>
			
			
			
			
			
			<!-- div *ngIf="deepEqual(loadedVer, ver); else changes_made_2">Loaded version:<strong>{{ver['id']}}</strong></div><ng-template #changes_made_2><div><h3><span class="mat-warn"> Unsaved new version: </span><strong> {{ver['id'] + 1}} </strong></h3></div></ng-template -->
			<div>	Total active hosts: <strong> 20	</strong></div>
			<div>	RSVPs: <strong> 20 </strong></div>
			<div><br/> Host seats available by event <br/><hr/>
				<div style="display: flex; justify-content: space-evenly;">
					<div> January:	<strong> 110	</strong></div>
					<div> February:	<strong> 80		</strong></div>
					<div> March:		<strong> 135	</strong></div>
				</div>
			</div>
		</mat-expansion-panel>
		<!-- #####################################################################################  VERSION METADATA  ## -->
		<!-- mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false"><mat-expansion-panel-header><mat-panel-title><strong> Version Metadata </strong></mat-panel-title><mat-panel-description> Misc info to help identify this version <mat-icon> more </mat-icon></mat-panel-description></mat-expansion-panel-header><div><h4><label for="next-labels"> Labels: </label><input type="text" id="next-labels" [(ngModel)]="ver['labels']" placeholder="labels(comma-separated)" /></h4></div></mat-expansion-panel-->
		<!-- ############################################################################  EVENT DATE CONFIGURATIONS  ## -->
		<!-- mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false"><mat-expansion-panel-header><mat-panel-title><strong> Event Dates </strong></mat-panel-title><mat-panel-description> Provide the specific dates for each event <mat-icon> date_range </mat-icon></mat-panel-description></mat-expansion-panel-header>
			<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: January	</mat-label><input matInput [matDatepicker]="picker1" (focus)="picker1.open()"></mat-form-field><mat-datepicker #picker1></mat-datepicker></div>
			<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: February	</mat-label><input matInput [matDatepicker]="picker2" (focus)="picker2.open()"></mat-form-field><mat-datepicker #picker2></mat-datepicker></div>
			<div style="text-align: center; width: 100%;"><mat-form-field appearance="fill" floatLabel="always"><mat-label> event: March	</mat-label><input matInput [matDatepicker]="picker3" (focus)="picker3.open()"></mat-form-field><mat-datepicker #picker3></mat-datepicker></div>
		</mat-expansion-panel -->
		<!-- ###################################################################################  HOST CONFIGURATIONS  ##-->
		<mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
			<mat-expansion-panel-header>
				<mat-panel-title><strong> Hosting </strong></mat-panel-title>
				<mat-panel-description>
					Schedule hosts for this event <mat-icon> person </mat-icon>
				</mat-panel-description>
			</mat-expansion-panel-header>
			<hr/>
			<div class="events" *ngFor="let evt of events">
				<div class="event-heading">
					<div>
						<h4><strong>{{evt}}</strong> Hostings </h4>
					</div>
					<div>
						Auto-assign:
						<button (click)="autoAllocate('all')"> All </button>
						<button (click)="autoAllocate(evt)">{{evt}}</button>
					</div>
				</div>
				<table cdkDropListGroup>
					<tr>
						<th style="background-color: #425; color: white; padding: 0 0.5em;">
							<strong> Unallocated </strong>
						</th>
						<th style="background-color: #425; color: white; padding: 0 0.5em;">
							<strong> Allocated 	</strong>
						</th>
					</tr>
					<tr>
						<!-- ############################################################################  UN-ASSIGNED HOSTS  ###-->
						<td cdkDropList id="unallocated" class="unassigned list"
								[cdkDropListData]			= "unHs[evt]"
								(cdkDropListDropped)	= "unDropHost( $event, evt )"
						>
							<div *ngFor="let unH of unHs[evt]">
								<mat-card cdkDrag [cdkDragData]="unH" [cdkDragDisabled]="unH['isDisabled']">
									<mat-icon> menu </mat-icon> {{ unH['hostKey'] }}
								</mat-card>
							</div>
						</td>
						<!-- ########################################################################  EVENT HOSTING SUMMARY  ###-->
						<td *ngIf="loaded || summary[evt]" class="vertical-info">
							<div style="background-color: aliceblue; margin: 0;">
								<strong> Seats </strong>
							</div>
							<div>
								Total: <strong>{{ summary[evt]['seats']}}</strong>
							</div>
							<div>
								< &nbsp;&nbsp; UNALLOCATED
							</div>
							<div>
								<strong>{{summary[evt]['unAllocatedSeatCnt']}}</strong>
							</div>
							<div>
								ALLOCATED	&nbsp;&nbsp;&nbsp; >
							</div>
							<div>
								<strong>{{summary[evt]['allocatedSeatCnt']}}</strong>
							</div>
							<div style="background-color: aliceblue">
								RSVPs: <strong>{{summary[evt]['rsvps']}}</strong>
							</div>
							<div [class]="summary[evt]['overAllocatedSeats'] >= 0 ? 'full' : 'not-full'">
								O/U RSVPs: <strong>{{
										summary[evt]['overAllocatedSeats'] > 0 ? '+' +	summary[evt]['overAllocatedSeats'] :
										summary[evt]['overAllocatedSeats'] < 0 ?				summary[evt]['overAllocatedSeats'] : '-'
								}}</strong>
							</div>
						</td>
						<!-- ###############################################################################  ASSIGNED HOSTS  ###-->
						<td cdkDropList id="allocated" [class] = "
									summary[evt]['overAllocatedSeats'] >= 0? 'assigned list full': 'assigned list not-full'
								"
								*ngIf									= "loaded || summary[evt] !== undefined"
								[cdkDropListData]			= "aHs[evt]"
								(cdkDropListDropped)	= "dropHost($event, evt)"
						>
							<div *ngFor="let aH of aHs[evt]">
								<mat-card cdkDrag id="{{aH['hostKey']}}" [cdkDragData]="aH">
									<mat-icon> menu </mat-icon>{{aH['hostKey']}}
								</mat-card>
							</div>
						</td>
					</tr>
				</table>
			</div>
			<mat-action-row>
				<button mat-button (click)="prevStep()"> Previous </button>
				<button mat-button (click)="nextStep()"> Next </button>
			</mat-action-row>
		</mat-expansion-panel>
		<!-- ###################################################################################  GUEST CONFIGURATION  ##-->
		<mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
			<mat-expansion-panel-header>
				<mat-panel-title>
					<strong> Guesting </strong>
				</mat-panel-title>
				<mat-panel-description>
					Schedule guests for this event <mat-icon> people </mat-icon>
				</mat-panel-description>
			</mat-expansion-panel-header>
			<hr/>
			<div  class="events" *ngFor="let evt of events">
				<div class="event-heading">
					<div><h4><strong>{{evt}} Guestings </strong></h4></div>
					<div>
						Auto-assign:
						<button (click)="autoAssign('all')"> All </button>
						<button (click)="autoAssign(evt)">{{evt}}</button>
					</div>
				</div>
				<!-- table cdkDropListGroup -->
				<table cdkDropListGroup *ngIf="this.summary[evt]">
					<tr>
						<th style="background-color: #425; color: white; padding: 0 0.5em;">
							<strong> Unassigned </strong>
						</th>
						<th style="background-color: #425; color: white; padding: 0 0.5em;">
							<strong> Assigned </strong>
						</th>
					</tr>
					<tr>
						<!-- ##########################################################################  UN-ASSIGNED GUESTS  ### -->
						<td cdkDropList id="unassigned" class="unassigned list"
								[cdkDropListData]			= "unGs[evt]"
								(cdkDropListDropped)	= "unDropGuest($event, evt)"
						>
							<div *ngFor="let unG of unGs[evt]">
								<mat-card cdkDrag id				= "{{unG['guestKey']}}"
													[cdkDragData]			= "unG"
													[cdkDragDisabled]	= "unG['isDisabled']"
								>
									<mat-icon> menu </mat-icon> {{unG['guestKey']}}
								</mat-card>
							</div>
						</td>
						<!-- ##########################################################################  EVENT GUEST SUMMARY  ###-->
						<td class="vertical-info">
							<div style="background-color: aliceblue; margin: 0;"><strong> Guests </strong></div>
							<div>
								RSVPs: <strong>{{summary[evt]['rsvps']}}</strong>
							</div>
							<div>
								< &nbsp; UNASSIGNED
							</div>
							<div>
								<strong>{{summary[evt]['unAssignedGuestCnt']}}</strong>
							</div>
							<div>
								ASSIGNED &nbsp;&nbsp;&nbsp;&nbsp; >
							</div>
							<div>
								<strong>{{summary[evt]['assignedGuestCnt']}}</strong>
							</div>
							<div style="background-color: aliceblue; margin: 0;">
								<strong> Seats </strong>
							</div>
							<div>
								TOTAL: <strong>{{summary[evt]['seats']}}</strong>
							</div>
							<div>
								ALLOCATED: <strong>{{summary[evt]['allocatedSeatCnt']}}</strong>
							</div>
							<div [class]="summary[evt]['overAllocatedSeats'] >= 0? 'full': 'not-full'">
								O/U RSVPs: <strong>{{
										summary[evt]['overAllocatedSeats'] > 0 ? '+' +	summary[evt]['overAllocatedSeats'] :
										summary[evt]['overAllocatedSeats'] < 0 ?				summary[evt]['overAllocatedSeats'] : '-'
								}}</strong>
							</div>
							<div [class]="summary[evt]['overAssignedGuests'] >= 0? 'full': 'not-full'">
								O/U ASSIGNED: <strong>{{
										summary[evt]['overAssignedGuests'] > 0 ? '+' +	summary[evt]['overAssignedGuests'] :
										summary[evt]['overAssignedGuests'] < 0 ?				summary[evt]['overAssignedGuests'] : '-'
								}}</strong>
							</div>
							<div>
								<button style="margin-top: 2em;" (click)="isOpen=!isOpen">
									{{isOpen? "Peeps View": "Card View"}}
								</button>
							</div>
						</td>
						<!-- ##############################################################################  ASSIGNED GUESTS  ###-->
						<td>
							<!-- div cdkDropList [id]="aH['hostKey']" style="border-style: inset; padding: .25em;" -->
							<div cdkDropList [id]="aH['hostKey']" style="text-align: center; max-width: 10em; height: 12em; max-height: 12em; padding: .5em;"
									 *ngFor="let aH of aHs[evt]"
									 [cdkDropListData]						= "aGs[evt][aH['hostKey']]"
									 (cdkDropListDropped)					= "dropGuest($event, evt)"
									 [cdkDropListEnterPredicate]	= "pairsPredicate()"
							>
								{{aH['hostKey']}}
								<!-- #############################################################  ASSIGNED GUESTS - PEEPS VIEW  ###-->
								<div *ngIf="summary[evt][aH['hostKey']]">
									<div	[class]	= "summary[evt][aH['hostKey']]['assignedSeatCnt']  <  aH['seats']  ?  'polyBase poly-' + aH['seats'] + ' not-full-host'	:
																		summary[evt][aH['hostKey']]['assignedSeatCnt']  >  aH['seats']  ?  'polyBase poly-' + aH['seats'] + ' over-full-host'	:
																		'polyBase poly-' + aH['seats'] + ' full-host'
												" *ngIf = "! isOpen; else boxView"
									>
										<div [class]="'poly-content-' + aH['seats']">
											<div *ngFor="let cnt of [].constructor(aH['seats']); let i = index">
												<mat-icon id="peep-1" class="assigned-guest-host peep" *ngIf="
																		i <= summary[evt][aH['hostKey']]['hosts'].length-1;
																		 else notHost
												"> person </mat-icon>
												<ng-template #notHost>
													<mat-icon id="peep-2" class="assigned-guest-guest peep" *ngIf="
																		i <= summary[evt][aH['hostKey']]['assignedSeatCnt']-1;
																			else notAssigned
													"> person </mat-icon>
													<ng-template #notAssigned>
														<mat-icon id="peep-o" class="unassigned-guest peep">
															person_outline
														</mat-icon>
													</ng-template>
												</ng-template>
											</div>
										</div>
									</div>
									<!-- ###########################################################  ASSIGNED GUESTS - CARD VIEW  ###-->
									<ng-template #boxView>
										<div	[class]="summary[evt][aH['hostKey']]['assignedSeatCnt'] < aH['seats'] ? 'polyBase list not-full-host' :
																		summary[evt][aH['hostKey']]['assignedSeatCnt'] > aH['seats'] ? 'polyBase list over-full-host' :
																				'polyBase list full-host'
										">
											<div *ngFor="let aG of aGs[evt][aH['hostKey']]">
												<mat-card cdkDrag id				= "{{aG['guestKey']}}"
																	[cdkDragData]			= "aG"
																	[cdkDragDisabled]	= "aG['isDisabled']"
												>
													<mat-icon> menu </mat-icon> {{aG['guestKey']}}
												</mat-card>
											</div>
										</div>
									</ng-template>
								</div>
							</div>
						</td>
					</tr>
				</table>
			</div>
			<mat-action-row>
				<button mat-button (click)="prevStep()">
					Previous
				</button>
				<button mat-button (click)="nextStep()">
					End
				</button>
			</mat-action-row>
		</mat-expansion-panel>
	</mat-accordion>
</div>
</div>
